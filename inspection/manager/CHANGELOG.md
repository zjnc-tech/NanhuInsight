# 更新日志

## [sprint9] - 2025-3-30

### 新增

* 在管控集群内通过名为Task的crd创建即时和定时的健康检查任务，并监听crd来进行健康检查任务的执行。

### 优化

* 优化节点查询与节点批量上传，在查询节点的时候获取节点状态。
* 优化统计结果，展示各检查项的节点统计数据。

### 修复

* 修复各集群任务处理器之间的竞态问题。

## [sprint8] - 2025-3-3

### 新增

* 支持获取集群资源类型列表，支持按节点ip向agent获取各节点对应的卡资源类型。
* 支持按资源级别创建健康检查任务及创建健康检查模板。

### 优化

* 优化告警注册和上报机制，将脚本返回各类型结果都分别注册告警规则，并统一告警上班路径。
* 重构执行层，将从集群k8s获取节点名称的功能从agent移到了manager侧。

### 修复

* 校验检查模板，对于空模板直接创建失败。
* 定时任务记录器的并发问题。

## [sprint7] - 2025-1-21

### 新增

* 支持按分钟级、小时级创建定时检查任务。
* 新增向agent获取指定集群内节点的卡类型，在执行健康检查任务之前检查所选节点卡类型是否一致。

### 优化

* 适配告警数据，支持将不健康、未知的检查结果上报告警。

### 修复

* 修复任务按开始时间和结束时间筛选健康检查任务。

## [sprint6] - 2025-1-3

### 新增

* 支持下载模板excel，并通过excel批量上传节点。
* 支持用户重新跑一次已经执行完成的健康检查任务。
* 支持为检查项增加执行参数，通过接口暴露参数名称、参数类型和默认值，并支持通过模板为检查项增加参数，并将指定参数通过gRPC一同发送给agent执行。
* 接入新Z2120集群。

### 优化

* 优化结果展示,以json形式返回节点名称、检查结果、检查信息等健康检查结果，并支持用户下载。
* 使用fsnotify优化脚本管理与监控功能，当挂载脚本路径下发生文件修改时，自动增删改脚本信息。

## [sprint5] - 2024-11-28

### 优化

* 将工程用golang重构，使用 beego框架+beego ORM 代替原来的 flask框架+SQLAlchemy。

### 新增

* 增加任务队列，同一集群内允许并发提交健康检查任务，并排队执行。
* 用例执行失败时以节点维度上报k8s事件。

### 修复
* 使用正则表达式匹配agent返回的多个节点失败的日志，将多个失败节点分别进行分析和上报。

## [sprint4] - 2024-9-27

### 新增

* manager重启后支持继续执行之前创建的定时任务。
* 创建健康检查任务时向告警中心注册，获取告警规则id。

### 优化

* 支持在新增和修改检查模板时对其对应的定时任务进行新增、修改或删除。

### 修复

* 健康检查模板新增集群字段，按集群进行展示和使用。

### 删除

* 创建定时任务接口。
* 删除定时任务接口。

## [sprint3] - 2024-9-13

### 优化

* 将健康检查后端与健康检查脚本进行解耦，backend改造为inspection-manager， executor改造为inspection-agent。
* 对健康检查后端进行联邦化改造，改为健康检查管控中心，支持对多个集群进行健康检查任务的创建和结果查看。

### 新增

* 通过grpc与agent进行通信，manager向agent发送执行参数与压缩后的脚本文件，agent返回检查结果和日志。
* 支持创建、修改、删除、查询检查模板。
* 支持根据模板创建即时健康检查任务。
* 新增巡检功能，支持用户在每天或每周、每月的固定时间，对目标集群发起健康检查。

## [sprint2] - 2024-7-15

### 新增

* 支持查看执行失败的任务详情。
* 支持用户获取集群内的节点列表，并选取部分节点进行健康检查。
* 一致性检查类的检查任务支持用户选择基线节点。
* 不通过的检查脚本以节点粒度上报告警。

### 优化

* 提高后端健壮性，在executor执行失败时进行异常处理。

## [sprint1] - 2024-6-16

### 新增

工程分为backend和executor两部分，其中： 
* backend：向上对接前端，使用python的flask框架向前端提供RESTful接口，提供创建健康检查任务、查看检查作业列表、查看任务结果详情、
查看任务中指定用例结果的功能； 向下对接executor，将用户下发的健康检查任务配置下发给executor，并获取、分析、落库检查结果。
* executor：包含检查脚本和对应的执行器，可以在集群中执行脚本，进行健康检查。